@model KarateIsere.Models.CompetitionViewModel

@using (Html.BeginForm( "Create", "Competitions", FormMethod.Post )) {
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        @Html.ValidationSummary( true, "", new {
       @class = "text-danger"
   } )
        <div class="form-group">
            @Html.LabelFor( model => model.Nom, htmlAttributes: new {
           @class = "control-label col-md-2"
       } )
            <div class="col-md-10">
                @Html.EditorFor( model => model.Nom, new {
               htmlAttributes = new {
                   @class = "form-control"
               }
           } )
                @Html.ValidationMessageFor( model => model.Nom, "", new {
               @class = "text-danger"
           } )
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor( model => model.DateCompetition, htmlAttributes: new {
           @class = "control-label col-md-2"
       } )
            <div class="col-md-10">
                @Html.EditorFor( model => model.DateCompetition, new {
               htmlAttributes = new {
                   @class = "form-control"
               }
           } )
                @Html.ValidationMessageFor( model => model.DateCompetition, "", new {
               @class = "text-danger"
           } )
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor( model => model.FinInscription, htmlAttributes: new {
           @class = "control-label col-md-2"
       } )
            <div class="col-md-10">
                @Html.EditorFor( model => model.FinInscription, new {
               htmlAttributes = new {
                   @class = "form-control"
               }
           } )
                @Html.ValidationMessageFor( model => model.FinInscription, "", new {
               @class = "text-danger"
           } )
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor( model => model.Lieu, htmlAttributes: new {
           @class = "control-label col-md-2"
       } )
            <div class="col-md-10">
                @Html.EditorFor( model => model.Lieu, new {
               htmlAttributes = new {
                   @class = "form-control"
               }
           } )
                @Html.ValidationMessageFor( model => model.Lieu, "", new {
               @class = "text-danger"
           } )
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor( model => model.IsKata, htmlAttributes: new {
           @class = "control-label col-md-2"
       } )
            <div class="col-md-10">
                <div class="checkbox">
                    @Html.EditorFor( model => model.IsKata )
                    @Html.ValidationMessageFor( model => model.IsKata, "", new {
                   @class = "text-danger"
               } )
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h4>Liste des catégories</h4>
                    </div>
                </div>
                <div class="panel-body">
                    <ul id="dragSource">
                        @foreach (var item in Model.CategorieList) {
                            <li id="@item.Text" draggable="true" ondragstart="drag(event)">@item.Text</li>
                        }
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h4>Glissez et déposez les catégories sélectionnées</h4>
                    </div>
                </div>

                <div id="dropzone" class="panel-body"
                     dropzone="true" ondrop="drop(event)" ondragover="allowDrop(event)" >

                    <ul id="dropDest">
                        @foreach (string item in Model.SelectedCategorie) {
                            <li id="@item" draggable="true" ondragstart="drag(event)">@item</li>
                        }
                    </ul>

                </div>
            </div>
        </div>




        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Créer" class="btn btn-default" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink( "Back to List", "Index" )
</div>

<script>
    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        console.log("drag" + ev);
        ev.dataTransfer.setData("text/html", ev.target.id);
    }

    function drop(ev) {
        console.log("drop" + ev);
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text/html");
        console.log(data);
        console.log(ev.target);
        // ev.target.appendChild(document.getElementById(data));

        $.ajax({
            type: "POST",
            url: "@Url.Action( "AddCategorie","Competitions" )",
            data: { name: data },
            success: function (res) {
                $("#dropDest").append(document.getElementById(data));
            }
        });
    }

</script>